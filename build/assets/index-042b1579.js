import{e as E,c as v,v as w}from"./index-31948834.js";import{u as D,c as T}from"./index-8c95c680.js";function _(t){const[s,p,c]=t.split(":").map(Number);return Number((s*60*60*1e3+p*60*1e3+c*1e3).toFixed(6))}function b(t){var i,d,a;const s=(i=t==null?void 0:t.properties)==null?void 0:i.timestamp,[p,c,m]=s?s.split(":").map(Number):[0,0,0],r=p*3600+c*60+m;return{title:((d=t==null?void 0:t.properties)==null?void 0:d.name)||"",description:"",startTime:r,endTime:r+30,source_link:((a=t==null?void 0:t.properties)==null?void 0:a.source_link)||""}}const G={selectedEpisode:null,clips:[],highlights:[],clipEdges:[],chapters:[],activeClip:null,selectedSegment:null},x=E(t=>({...G,setSelectedEpisode:s=>t({selectedEpisode:s}),setClips:s=>t({clips:s}),setChapters:s=>t({chapters:s}),fetchEpisodeData:async s=>{const{addNewNode:p}=v.getState(),{setPlayingNode:c}=D.getState(),{setNeighbourhoods:m}=T.getState(),r=await w(s,["Clip","Chapter","Show","Host","Guest"],[],"",!0,0,1,500),i=r.nodes.filter(e=>e.node_type==="Clip").filter(e=>{var o;return(o=e.properties)==null?void 0:o.timestamp}).sort((e,o)=>{var g,u,f,S;const n=Number((u=(g=e.properties)==null?void 0:g.timestamp)==null?void 0:u.split("-")[0]),l=Number((S=(f=o.properties)==null?void 0:f.timestamp)==null?void 0:S.split("-")[0]);return n-l}),d=r.edges.filter(e=>i.some(o=>o.ref_id===e.source)||i.some(o=>o.ref_id===e.target)),a=r.nodes.filter(e=>e.node_type==="Chapter").sort((e,o)=>{var n,l;return _(((n=e==null?void 0:e.properties)==null?void 0:n.timestamp)||"")-_(((l=o==null?void 0:o.properties)==null?void 0:l.timestamp)||"")}),y=a.map(b),N=a.map(e=>{var o;return{ref_id:e.ref_id,name:((o=e.properties)==null?void 0:o.name)||""}});m(N);const h=r.nodes.find(e=>e.node_type==="Episode");h&&c(h);const C=r.nodes.filter(e=>e.node_type==="Show"||e.node_type==="Episode"||e.node_type==="Host"||e.node_type==="Guest");p({nodes:[...C],edges:[...r.edges]}),t({clips:i,chapters:a,selectedEpisode:h,clipEdges:d,highlights:y})},setActiveClip:s=>t({activeClip:s}),setSelectedSegment:s=>t({selectedSegment:s})}));export{_ as t,x as u};
